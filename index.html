<!doctype html>
<html lang="es-MX">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Valentine</title>
    <style>
        :root{
            --bg1:#efe9df;
            --bg2:#fff0d8;
            --bg3:#e9d1b0;

            --text:#2b1f14;
            --yes:#7dad8d;
            --no:#a96e6e;

            --letterH: clamp(38px, 7vw, 70px);
            --letterGap: clamp(6px, 1.2vw, 12px);
            --wordGap: clamp(14px, 3.2vw, 34px);
            --rowGap: clamp(10px, 2.6vw, 26px);

            --decorSize: clamp(48px, 8.4vw, 115px);
            --decorOpacity: 0.88;
        }

        *{
            box-sizing:border-box;
        }

        body{
            margin:0;
            min-height:100vh;
            display:grid;
            place-items:center;
            background: radial-gradient(circle at 50% 35%, var(--bg1) 0%, var(--bg2) 58%, var(--bg3) 100%);
            font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
            color:var(--text);
        }

        .scene{
            position:relative;
            width:100%;
            min-height:100vh;
            display:grid;
            place-items:center;
            overflow:hidden;
        }

        .decorations{
            position:absolute;
            inset:0;
            pointer-events:none;
            z-index:0;
        }

        .decorations img{
            position:absolute;
            width:var(--decorSize);
            height:auto;
            opacity:var(--decorOpacity);
            filter: drop-shadow(0 10px 22px rgba(0,0,0,.10));
            transform: rotate(var(--rot, 0deg));
        }

        .wrap{
            position:relative;
            z-index:1;
            width:min(980px, 92vw);
            padding:28px 16px 34px;
            text-align:center;
        }

        .phrase{
            display:flex;
            flex-wrap:wrap;
            justify-content:center;
            align-items:flex-end;
            gap: var(--rowGap) var(--wordGap);
            margin-bottom: 18px;
            user-select:none;
        }

        .word{
            display:inline-flex;
            align-items:flex-end;
            gap: var(--letterGap);
        }

        @keyframes wiggle{
            0%{
                transform: translate(0px, 0px) rotate(var(--baseRot));
            }
            20%{
                transform: translate(1px, -1px) rotate(calc(var(--baseRot) + 1.5deg));
            }
            40%{
                transform: translate(-1px, 1px) rotate(calc(var(--baseRot) - 1.2deg));
            }
            60%{
                transform: translate(1px, 1px) rotate(calc(var(--baseRot) + 0.8deg));
            }
            80%{
                transform: translate(-1px, -1px) rotate(calc(var(--baseRot) - 1.0deg));
            }
            100%{
                transform: translate(0px, 0px) rotate(var(--baseRot));
            }
        }

        .word img{
            height: var(--letterH);
            width: auto;
            display:block;
            filter: drop-shadow(0 8px 16px rgba(0,0,0,.14));
            pointer-events:none;
            transform-origin: 50% 75%;
            will-change: transform;
            animation-name: wiggle;
            animation-timing-function: ease-in-out;
            animation-iteration-count: infinite;
        }

        @media (prefers-reduced-motion: reduce){
            .word img{
                animation: none;
            }
        }

        .btnRow{
            position:relative;
            display:inline-flex;
            align-items:center;
            gap:14px;
            margin-top: 10px;
        }

        .btn{
            border:0;
            padding: 12px 22px;
            font-size: 18px;
            border-radius: 12px;
            cursor:pointer;
            color:#fff;
            font-weight:750;
            letter-spacing: 0.5px;
            box-shadow:0 10px 26px rgba(0,0,0,.18);
            transition: transform .08s ease;
            user-select:none;
            touch-action: manipulation;
        }

        .btn:active{
            transform:scale(.98);
        }

        #yesBtn{
            background:var(--yes);
        }

        #noBtn{
            background:var(--no);
            position:fixed;
            left: 70vw;
            top: 60vh;
            z-index:2;
        }

        .msg{
            margin-top:14px;
            font-size:18px;
            min-height:26px;
        }
    </style>
</head>
<body>
    <div class="scene">
        <div class="decorations" id="decorations"></div>

        <div class="wrap">
            <div class="phrase" id="phrase"></div>

            <div class="btnRow">
                <button class="btn" id="yesBtn">YES</button>
            </div>

            <div class="msg" id="msg"></div>
        </div>

        <button class="btn" id="noBtn">NO</button>
    </div>

    <script src="config.js"></script>
    <script>
        const phrase = document.getElementById("phrase");
        const decorations = document.getElementById("decorations");
        const noBtn = document.getElementById("noBtn");
        const yesBtn = document.getElementById("yesBtn");
        const msg = document.getElementById("msg");
        let lastNoAttemptAt = 0;

        const words = [
            [12, 13, 14, 15, 16],
            [17, 18],
            [19, 20],
            [21, 22, 23, 24, 25, 26, 27, 28, 29, 30]
        ];

        function rand(min, max) {
            return Math.random() * (max - min) + min;
        }

        function clamp(v, min, max) {
            return Math.max(min, Math.min(max, v));
        }

        function px(n) {
            return `${Math.round(n)}px`;
        }

        function makeLetterImg(n) {
            const img = document.createElement("img");
            img.src = `decoration/${n}.png`;
            img.alt = `letra ${n}`;

            const baseRot = rand(-6, 6);
            img.style.setProperty("--baseRot", `${baseRot.toFixed(2)}deg`);

            img.style.animationDuration = `${rand(1.8, 3.2).toFixed(2)}s`;
            img.style.animationDelay = `${rand(-1.8, 0).toFixed(2)}s`;

            return img;
        }

        for (const w of words) {
            const wordDiv = document.createElement("div");
            wordDiv.className = "word";

            for (const n of w) {
                wordDiv.appendChild(makeLetterImg(n));
            }

            phrase.appendChild(wordDiv);
        }

        function shuffle(arr) {
            const a = arr.slice();
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                const tmp = a[i];
                a[i] = a[j];
                a[j] = tmp;
            }
            return a;
        }

        function addDecorPx(n, x, y, s, rotDeg, opacity) {
            const img = document.createElement("img");
            img.src = `decoration/${n}.png`;
            img.alt = `decor ${n}`;

            img.style.left = px(x);
            img.style.top = px(y);
            img.style.width = `calc(var(--decorSize) * ${s})`;
            img.style.setProperty("--rot", `${rotDeg}deg`);
            img.style.opacity = `${opacity}`;

            decorations.appendChild(img);
        }

        function buildDecorations() {
            decorations.innerHTML = "";

            const r = phrase.getBoundingClientRect();

            const base = parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--decorSize")) || 95;
            const padX = clamp(base * 1.15, 55, 150);
            const padY = clamp(base * 0.95, 45, 130);

            const leftX = r.left - padX;
            const rightX = r.right + padX;
            const topY = r.top - padY;
            const bottomY = r.bottom + padY;

            const midX = (r.left + r.right) / 2;
            const midY = (r.top + r.bottom) / 2;

            const margin = 10;

            function safeX(x) {
                return clamp(x, margin, window.innerWidth - margin);
            }

            function safeY(y) {
                return clamp(y, margin, window.innerHeight - margin);
            }

            const anchors = [
                { x: leftX - base * 0.55,  y: topY + base * 0.10 },
                { x: leftX - base * 0.10,  y: midY - base * 0.35 },
                { x: leftX + base * 0.35,  y: bottomY - base * 0.40 },

                { x: rightX - base * 0.30, y: bottomY - base * 0.40 },
                { x: rightX - base * 0.10, y: midY - base * 0.30 },
                { x: rightX - base * 0.05, y: topY + base * 0.12 },

                { x: r.left + base * 0.10,  y: topY - base * 0.15 },
                { x: r.right - base * 0.75, y: topY - base * 0.12 },

                { x: r.left + base * 0.05,  y: bottomY + base * 0.10 },
                { x: r.right - base * 0.70, y: bottomY + base * 0.10 },

                { x: midX - base * 0.55, y: bottomY + base * 0.55 },
                { x: midX - base * 0.55, y: topY - base * 0.65 }
            ];

            const decorPool = [];
            for (let i = 1; i <= 11; i++) {
                decorPool.push(i);
            }
            decorPool.push(31);

            const shuffledDecor = shuffle(decorPool);

            const targetCount = window.innerWidth < 420 ? 7 : 10;
            const chosen = shuffledDecor.slice(0, targetCount);

            const used = [];

            function okDistance(x, y, radius) {
                for (const u of used) {
                    const dx = x - u.x;
                    const dy = y - u.y;
                    const d2 = dx * dx + dy * dy;
                    const minD = radius + u.radius;
                    if (d2 < minD * minD) {
                        return false;
                    }
                }
                return true;
            }

            const anchorsShuffled = shuffle(anchors);

            for (let i = 0; i < chosen.length; i++) {
                const n = chosen[i];
                const a = anchorsShuffled[i % anchorsShuffled.length];

                let placed = false;

                for (let attempt = 0; attempt < 45 && !placed; attempt++) {
                    const s = rand(1.05, 1.45);
                    const rot = rand(-14, 14);
                    const op = rand(0.60, 0.92);

                    const size = base * s;
                    const radius = size * 0.62 + 5;

                    const jitterX = rand(-base * 0.22, base * 0.22);
                    const jitterY = rand(-base * 0.20, base * 0.20);

                    const x = safeX(a.x + jitterX);
                    const y = safeY(a.y + jitterY);

                    if (okDistance(x, y, radius)) {
                        addDecorPx(n, x, y, s, rot, op);
                        used.push({ x, y, radius });
                        placed = true;
                    }
                }
            }
        }

        window.addEventListener("load", buildDecorations);
        window.addEventListener("resize", buildDecorations);

        function moveNoButton() {
            const margin = 12;
            const b = noBtn.getBoundingClientRect();

            const maxX = window.innerWidth - b.width - margin;
            const maxY = window.innerHeight - b.height - margin;

            const x = Math.random() * maxX;
            const y = Math.random() * maxY;

            noBtn.style.left = `${clamp(x, margin, maxX)}px`;
            noBtn.style.top  = `${clamp(y, margin, maxY)}px`;
        }

        function initNoButtonPosition() {
            const margin = 12;
            const b = noBtn.getBoundingClientRect();

            const x = clamp(window.innerWidth * 0.72, margin, window.innerWidth - b.width - margin);
            const y = clamp(window.innerHeight * 0.60, margin, window.innerHeight - b.height - margin);

            noBtn.style.left = `${x}px`;
            noBtn.style.top = `${y}px`;
        }

        window.addEventListener("load", initNoButtonPosition);
        window.addEventListener("resize", initNoButtonPosition);

        async function sendAnswerEvent(answer) {
            try {
                if (!ENDPOINT_URL || ENDPOINT_URL.includes("PASTE_")) {
                    return;
                }

                const payload = new URLSearchParams({
                    answer: answer,
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    pageUrl: location.href,
                    referrer: document.referrer || ""
                });

                await fetch(ENDPOINT_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8"
                    },
                    body: payload.toString(),
                    mode: "no-cors",
                    keepalive: true
                });
            } catch (err) {
                console.warn("No se pudo enviar evento:", err);
            }
        }

        noBtn.addEventListener("mouseenter", () => {
            msg.textContent = "";
            moveNoButton();
        });

        noBtn.addEventListener("pointerdown", (e) => {
            e.preventDefault();
            msg.textContent = "Respuesta incorrecta jsjsjs";
            moveNoButton();
            lastNoAttemptAt = Date.now();
            sendAnswerEvent("NO_ATTEMPT");
        });

        noBtn.addEventListener("click", (e) => {
            e.preventDefault();
            msg.textContent = "Respuesta incorrecta jsjsjs";
            moveNoButton();
            if (Date.now() - lastNoAttemptAt > 450) {
                sendAnswerEvent("NO_ATTEMPT");
            }
        });

        yesBtn.addEventListener("click", () => {
            msg.textContent = "Excelenteeee. Nos vemos el 15 de febrero :) ";
            noBtn.style.display = "none";
            sendAnswerEvent("YES");
        });
    </script>
</body>
</html>
